var Y=Object.defineProperty,G=Object.defineProperties;var Q=Object.getOwnPropertyDescriptors;var q=Object.getOwnPropertySymbols;var X=Object.prototype.hasOwnProperty,Z=Object.prototype.propertyIsEnumerable;var B=(e,t,n)=>t in e?Y(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,w=(e,t)=>{for(var n in t||(t={}))X.call(t,n)&&B(e,n,t[n]);if(q)for(var n of q(t))Z.call(t,n)&&B(e,n,t[n]);return e},U=(e,t)=>G(e,Q(t));import{r as ee,a as te,c as T,b as f,o as c,d as l,t as b,e as v,f as a,g as $,w as W,p as A,h as P,i as J,j as V,F as C,k as d,v as m,l as se,m as z,n as oe,q as N,s as re,u as ae,x as ne,y as ie}from"./vendor.f0522b0b.js";const ce=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function n(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerpolicy&&(o.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?o.credentials="include":s.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(s){if(s.ep)return;s.ep=!0;const o=n(s);fetch(s.href,o)}};ce();class y{static getAccessToken(){return localStorage.getItem("access_token")}static setAccessToken(t){localStorage.setItem("access_token",t)}static setRefreshToken(t){localStorage.setItem("refresh_token",t)}static getRefreshToken(){return localStorage.getItem("refresh_token")}static clearTokens(){localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token")}}const u=ee({userData:{user:null},isLoggedIn:!1,loading:!1,error:""}),le={getIsLoggedIn:()=>T(()=>u.isLoggedIn),getLoading:()=>T(()=>u.loading),getError:()=>T(()=>u.error),getUser:()=>T(()=>u.userData)},K={setUser:e=>{K.setIsLoggedIn(!0),u.userData.user=e},setIsLoggedIn:e=>{u.isLoggedIn=e,e===!1&&(u.userData.user=null,y.clearTokens())},setLoading:e=>{u.loading=e},setError:e=>{u.error=e}},de={decodeJWT:e=>{try{return JSON.parse(atob(e.split(".")[1]))}catch{return null}}};var L=()=>w(w(w({state:te(u)},le),K),de),ue="/assets/logo.03d6d6da.png";var g=(e,t)=>{const n=e.__vccOpts||e;for(const[i,s]of t)n[i]=s;return n};const pe={name:"Header",data(){return{isLoggedIn:!1}},props:{username:String},async created(){const{getIsLoggedIn:e}=L();this.isLoggedIn=e()}},_e=e=>(A("data-v-0b64d540"),e=e(),P(),e),me=_e(()=>a("img",{alt:"Vue logo",src:ue},null,-1)),ge={key:0},he={id:"nav"},fe=J("Home"),ve=J("About");function ye(e,t,n,i,s,o){const r=f("router-link");return c(),l("header",null,[me,s.isLoggedIn?(c(),l("h1",ge,"Welcome back "+b(n.username),1)):v("",!0),a("nav",he,[$(r,{to:"/"},{default:W(()=>[fe]),_:1}),$(r,{to:"/about"},{default:W(()=>[ve]),_:1})])])}var we=g(pe,[["render",ye],["__scopeId","data-v-0b64d540"]]);const be={name:"Footer"},ke=e=>(A("data-v-328c9808"),e=e(),P(),e),xe=ke(()=>a("p",null,"OmniList \xA9 2022",-1)),$e=[xe];function Ae(e,t,n,i,s,o){return c(),l("footer",null,$e)}var Pe=g(be,[["render",Ae],["__scopeId","data-v-328c9808"]]);const p=V.create();p.interceptors.request.use(e=>{const t=y.getAccessToken();return t&&(e.headers.Authorization="Bearer "+t),e.headers["Content-Type"]="application/json",e},e=>{Promise.reject(e)});p.interceptors.response.use(async e=>e,async e=>{if(e.response&&e.response.status===403){console.log("token expired");const t=await Ie(e);return console.log("retrying request"),t}return Promise.reject(e)});let M=!1,R=[];async function Ie(e){try{const{response:t}=e,n=y.getRefreshToken();if(!n)return console.log("no refresh token"),Promise.reject(e);const i=new Promise(async s=>{await Le(o=>{t.config.headers.Authorization="Bearer "+o,s(V(t.config))})});if(!M){console.log("fetching access token"),M=!0;const s=await V({method:"post",url:"/api/refresh",data:{token:n}});if(!s.data)return Promise.reject(e);const o=s.data.accessToken;y.setAccessToken(o),M=!1,await Te(o)}return i}catch(t){return Promise.reject(t)}}async function Te(e){R.forEach(t=>t(e)),R=[]}async function Le(e){R.push(e)}const k="/api/";class D{static async getUsers(){return new Promise(async(t,n)=>{try{const s=(await p.get(`${k}user`)).data;t(s.map(o=>U(w({},o),{createdAt:new Date(o.createdAt),updatedAt:new Date(o.updatedAt)})))}catch(i){n(i.response)}})}static async getUser(t){try{return await p.get(`${k}user/${t}`)}catch(n){return n.response}}static async registerUser(t){try{return await p.post(`${k}register`,t)}catch(n){return n.response}}static async loginUser(t){try{return await p.post(`${k}login`,t)}catch(n){return n.response}}static async logoutUser(t){try{return await p.post(`${k}logout`,t)}catch(n){return n.response}}}const Se={name:"App",components:{Header:we,Footer:Pe},data(){return{result:""}},async created(){try{const{setUser:e,decodeJWT:t,getUser:n}=L(),i=y.getAccessToken(),{user:s}=t(i).user,o=await D.getUser(s._id);o.status===200&&(e(o.data),this.result=n())}catch(e){console.log(e.message)}}};function Ue(e,t,n,i,s,o){var j,H,O;const r=f("Header"),h=f("router-view"),S=f("Footer");return c(),l(C,null,[$(r,{username:((j=s.result.user)==null?void 0:j.username)===void 0?(H=s.result.user)==null?void 0:H.email:(O=s.result.user)==null?void 0:O.username},null,8,["username"]),a("main",null,[$(h)]),$(S)],64)}var Ne=g(Se,[["render",Ue]]);const F="/api/posts/";class x{static getPosts(){return new Promise(async(t,n)=>{try{const s=(await p.get(F)).data;t(s.map(o=>U(w({},o),{createdAt:new Date(o.createdAt)})))}catch(i){n(i)}})}static insertPost(t){return p.post(F,{text:t})}static deletePost(t){return p.delete(`${F}${t}`)}}const Me={name:"PostComponent",data(){return{posts:[],error:"",text:""}},async created(){try{this.posts=await x.getPosts()}catch(e){this.error=e.message}},methods:{async createPost(){await x.insertPost(this.text),this.posts=await x.getPosts(),this.text=""},async deletePost(e){await x.deletePost(e),this.posts=await x.getPosts()}}},E=e=>(A("data-v-37eb1acf"),e=e(),P(),e),Fe={class:"container"},Ve=E(()=>a("h1",null,"Latest Posts",-1)),Re={class:"create-post"},Ce=E(()=>a("label",{for:"create-post"},"Say something...",-1)),De=E(()=>a("hr",null,null,-1)),Ee={key:0,class:"error"},je={class:"posts-container"},He=["onDblclick"],Oe={class:"created-at"},qe={class:"text"};function Be(e,t,n,i,s,o){return c(),l("div",Fe,[Ve,a("div",Re,[Ce,d(a("input",{type:"text",id:"create-post","onUpdate:modelValue":t[0]||(t[0]=r=>s.text=r),placeholder:"Create a post"},null,512),[[m,s.text]]),a("button",{onClick:t[1]||(t[1]=(...r)=>o.createPost&&o.createPost(...r))},"Post!")]),De,s.error?(c(),l("p",Ee,b(s.error),1)):v("",!0),a("div",je,[(c(!0),l(C,null,se(s.posts,r=>(c(),l("div",{class:"post",key:r._id,onDblclick:h=>o.deletePost(r._id)},[a("div",Oe,b(`${r.createdAt.getDate()}/${r.createdAt.getMonth()}/${r.createdAt.getFullYear()}`),1),a("p",qe,b(r.text),1)],40,He))),128))])])}var We=g(Me,[["render",Be],["__scopeId","data-v-37eb1acf"]]);const Je={name:"Login",data(){return{email:"",password:"",errorMsg:""}},methods:{async login(){const{setUser:e,decodeJWT:t}=L();if(this.email.trim()!==""&&this.password.trim()!==""){const n={email:this.email,password:this.password},i=await D.loginUser(n);if(i.status===200){const{accessToken:s,refreshToken:o}=i.data,r=t(s);e(r),y.setAccessToken(s),y.setRefreshToken(o),this.email="",this.password=""}else this.errorMsg="Invalid login"}else this.errorMsg="Email and Password and required fields"},hasAccount(){this.$emit("toggle-form",!1)}}},I=e=>(A("data-v-5e209e2c"),e=e(),P(),e),ze=I(()=>a("h1",null,"Login",-1)),Ke={key:0,class:"error"},Ye={class:"input"},Ge=I(()=>a("label",{for:"email"},"email",-1)),Qe={class:"input"},Xe=I(()=>a("label",{for:"password"},"password",-1)),Ze=I(()=>a("input",{type:"submit",value:"login"},null,-1)),et={class:"toggle"},tt=I(()=>a("p",null,"Don't have an account?",-1));function st(e,t,n,i,s,o){return c(),l("form",{onSubmit:t[3]||(t[3]=z((...r)=>o.login&&o.login(...r),["prevent"]))},[ze,s.errorMsg.length>0?(c(),l("span",Ke,b(s.errorMsg),1)):v("",!0),a("div",Ye,[Ge,d(a("input",{id:"email","onUpdate:modelValue":t[0]||(t[0]=r=>s.email=r),type:"text"},null,512),[[m,s.email]])]),a("div",Qe,[Xe,d(a("input",{id:"password","onUpdate:modelValue":t[1]||(t[1]=r=>s.password=r),type:"text"},null,512),[[m,s.password]])]),Ze,a("div",et,[tt,a("button",{onClick:t[2]||(t[2]=(...r)=>o.hasAccount&&o.hasAccount(...r))},"Register")])],32)}var ot=g(Je,[["render",st],["__scopeId","data-v-5e209e2c"]]);const rt={name:"Register",data(){return{email:"",password:"",repeatPassword:"",username:"",firstName:"",lastName:"",extraToggle:!1,errorMsg:""}},methods:{async onSubmit(e){this.errorMsg="",this.email.trim()!==""&&this.password.trim()!==""&&this.repeatPassword.trim()!==""?this.password.trim()===this.repeatPassword.trim()?await this.createUser(e):this.errorMsg="Passwords don't match":this.errorMsg="Email and Password are required!"},async createUser(e){const{email:t,password:n,username:i,firstName:s,lastName:o}=Object.fromEntries(new FormData(e.target)),r={username:i,password:n,firstName:s,lastName:o,email:t},h=await D.registerUser(r);h.status===201?(this.email="",this.password="",this.repeatPassword="",this.username="",this.firstName="",this.lastName="",this.errorMsg=""):h.status===422?this.errorMsg="Email already in use":this.errorMsg="Something went wrong, try again later"},hasAccount(){this.$emit("toggle-form",!0)}}},_=e=>(A("data-v-9807cb52"),e=e(),P(),e),at=_(()=>a("h1",null,"Register",-1)),nt={key:0,class:"error"},it={class:"input"},ct=_(()=>a("label",{for:"email"},"email",-1)),lt=_(()=>a("label",{class:"extra-details",for:"extraToggle"},"Extra details...",-1)),dt={class:"extra"},ut={class:"input"},pt=_(()=>a("label",{for:"username"},"username",-1)),_t={class:"input"},mt=_(()=>a("label",{for:"firstName"},"first",-1)),gt={class:"input"},ht=_(()=>a("label",{for:"lastName"},"last",-1)),ft={class:"input"},vt=_(()=>a("label",{for:"password"},"password",-1)),yt={class:"input"},wt=_(()=>a("label",{for:"repeatPassword"},"repeat password",-1)),bt=_(()=>a("input",{type:"submit",value:"register"},null,-1)),kt={class:"toggle"},xt=_(()=>a("p",null,"Have an account?",-1));function $t(e,t,n,i,s,o){return c(),l("form",{onSubmit:t[8]||(t[8]=z((...r)=>o.onSubmit&&o.onSubmit(...r),["prevent"]))},[at,s.errorMsg.length>0?(c(),l("span",nt,b(s.errorMsg),1)):v("",!0),a("div",it,[ct,d(a("input",{id:"email",name:"email","onUpdate:modelValue":t[0]||(t[0]=r=>s.email=r),type:"text"},null,512),[[m,s.email]])]),d(a("input",{id:"extraToggle",name:"extraToggle","onUpdate:modelValue":t[1]||(t[1]=r=>s.extraToggle=r),type:"checkbox"},null,512),[[oe,s.extraToggle]]),lt,a("div",dt,[a("div",ut,[pt,d(a("input",{id:"username",name:"username","onUpdate:modelValue":t[2]||(t[2]=r=>s.username=r),type:"text"},null,512),[[m,s.username]])]),a("div",_t,[mt,d(a("input",{id:"firstName",name:"firstName","onUpdate:modelValue":t[3]||(t[3]=r=>s.firstName=r),type:"text"},null,512),[[m,s.firstName]])]),a("div",gt,[ht,d(a("input",{id:"lastName",name:"lastName","onUpdate:modelValue":t[4]||(t[4]=r=>s.lastName=r),type:"text"},null,512),[[m,s.lastName]])])]),a("div",ft,[vt,d(a("input",{id:"password",name:"password","onUpdate:modelValue":t[5]||(t[5]=r=>s.password=r),type:"text"},null,512),[[m,s.password]])]),a("div",yt,[wt,d(a("input",{id:"repeatPassword",name:"repeatPassword","onUpdate:modelValue":t[6]||(t[6]=r=>s.repeatPassword=r),type:"text"},null,512),[[m,s.repeatPassword]])]),bt,a("div",kt,[xt,a("button",{onClick:t[7]||(t[7]=(...r)=>o.hasAccount&&o.hasAccount(...r))},"Login")])],32)}var At=g(rt,[["render",$t],["__scopeId","data-v-9807cb52"]]);const Pt={name:"Home",components:{PostComponent:We,Login:ot,Register:At},data(){return{isLoggedIn:!1,hasAccount:!1,users:[]}},async created(){const{getIsLoggedIn:e}=L();this.isLoggedIn=e()},methods:{toggleForm(e){this.hasAccount=e}}};function It(e,t,n,i,s,o){const r=f("PostComponent"),h=f("Login"),S=f("Register");return c(),l(C,null,[s.isLoggedIn===!0?(c(),N(r,{key:0})):v("",!0),s.hasAccount===!0&&s.isLoggedIn===!1?(c(),N(h,{key:1,onToggleForm:o.toggleForm},null,8,["onToggleForm"])):v("",!0),s.hasAccount===!1&&s.isLoggedIn===!1?(c(),N(S,{key:2,onToggleForm:o.toggleForm},null,8,["onToggleForm"])):v("",!0)],64)}var Tt=g(Pt,[["render",It]]),Lt="/assets/mongodb.e2bfe7d8.png",St="/assets/mongoose.e352560f.png",Ut="/assets/expressjs.40799037.svg",Nt="/assets/vue.77ba2af1.svg",Mt="/assets/vite.17e50649.svg",Ft="/assets/node.a2054365.svg";const Vt={name:"About"},Rt={class:"container"},Ct=re('<h1 data-v-0e84b287>About the project</h1><dl data-v-0e84b287><dt data-v-0e84b287><span class="mongo" data-v-0e84b287>M</span><span class="express" data-v-0e84b287>E</span><span class="vue" data-v-0e84b287>V</span><span class="node" data-v-0e84b287>N</span> Stack</dt><dd class="mongo" data-v-0e84b287><img alt="mongo" src="'+Lt+'" data-v-0e84b287>Mongo DB<span class="mongoose" data-v-0e84b287>+ Mongoose<img alt="mongoose" src="'+St+'" data-v-0e84b287></span></dd><dd class="express" data-v-0e84b287><img alt="express" src="'+Ut+'" data-v-0e84b287>Express.js</dd><dd class="vue" data-v-0e84b287><img alt="vue" src="'+Nt+'" data-v-0e84b287>Vue + Vite<img alt="vite" src="'+Mt+'" data-v-0e84b287></dd><dd class="node" data-v-0e84b287><img alt="node" src="'+Ft+'" data-v-0e84b287>Node</dd></dl>',2),Dt=[Ct];function Et(e,t,n,i,s,o){return c(),l("div",Rt,Dt)}var jt=g(Vt,[["render",Et],["__scopeId","data-v-0e84b287"]]);const Ht=[{path:"/",name:"Home",component:Tt},{path:"/about",name:"About",component:jt}],Ot=ae({history:ne("/"),routes:Ht,linkExactActiveClass:"active"});ie(Ne).use(Ot).mount("#app");
