var X=Object.defineProperty,Z=Object.defineProperties;var ee=Object.getOwnPropertyDescriptors;var q=Object.getOwnPropertySymbols;var te=Object.prototype.hasOwnProperty,se=Object.prototype.propertyIsEnumerable;var z=(e,t,r)=>t in e?X(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,k=(e,t)=>{for(var r in t||(t={}))te.call(t,r)&&z(e,r,t[r]);if(q)for(var r of q(t))se.call(t,r)&&z(e,r,t[r]);return e},M=(e,t)=>Z(e,ee(t));import{r as oe,a as re,c as F,b as u,o as c,d as l,e as n,f as $,w as R,g as _,p as N,h as T,i as E,j as D,F as j,k as g,v as h,t as I,l as ne,m as J,n as ae,q as y,s as ie,u as ce,x,y as le,z as de,A as ue}from"./vendor.a9feca9c.js";const _e=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function r(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerpolicy&&(o.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?o.credentials="include":s.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(s){if(s.ep)return;s.ep=!0;const o=r(s);fetch(s.href,o)}};_e();class P{static getAccessToken(){return localStorage.getItem("access_token")}static setAccessToken(t){localStorage.setItem("access_token",t)}static setRefreshToken(t){localStorage.setItem("refresh_token",t)}static getRefreshToken(){return localStorage.getItem("refresh_token")}static clearTokens(){localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token")}}const v=oe({userData:{user:null},isLoggedIn:!1,loading:!1,error:""}),me={getIsLoggedIn:()=>F(()=>v.isLoggedIn),getLoading:()=>F(()=>v.loading),getError:()=>F(()=>v.error),getUser:()=>F(()=>v.userData)},W={setUser:e=>{W.setIsLoggedIn(!0),v.userData.user=e},setIsLoggedIn:e=>{v.isLoggedIn=e,e===!1&&(v.userData.user=null,P.clearTokens())},setLoading:e=>{v.loading=e},setError:e=>{v.error=e}},pe={decodeJWT:e=>{try{return JSON.parse(atob(e.split(".")[1]))}catch{return null}}};var C=()=>k(k(k({state:re(v)},me),W),pe),ge="/assets/logo.03d6d6da.png";var d=(e,t)=>{const r=e.__vccOpts||e;for(const[i,s]of t)r[i]=s;return r};const ve={name:"Header",data(){return{isLoggedIn:!1}},props:{user:{}},async created(){const{getIsLoggedIn:e}=C();this.isLoggedIn=e(),console.log("something",this.user)}},fe=e=>(N("data-v-45a8efd3"),e=e(),T(),e),he={id:"nav"},ye=fe(()=>n("img",{class:"logo",src:ge,alt:""},null,-1)),we={class:"nav-items"},$e=E("Home"),be=E("About"),Pe=E("Profile"),ke=["src"];function xe(e,t,r,i,s,o){var m,w,b;const a=u("router-link");return c(),l("header",null,[n("nav",he,[ye,n("div",we,[$(a,{to:"/"},{default:R(()=>[$e]),_:1}),$(a,{to:"/about"},{default:R(()=>[be]),_:1}),$(a,{to:"/profile/"+((m=r.user)==null?void 0:m.userName)},{default:R(()=>[Pe]),_:1},8,["to"])]),s.isLoggedIn?(c(),l("img",{key:0,class:"user",src:(b=(w=r.user)==null?void 0:w.img)!=null?b:"https://picsum.photos/seed/user/50",alt:""},null,8,ke)):_("",!0)])])}var Ae=d(ve,[["render",xe],["__scopeId","data-v-45a8efd3"]]);const Ie={name:"Footer"},Se=e=>(N("data-v-328c9808"),e=e(),T(),e),Le=Se(()=>n("p",null,"OmniList \xA9 2022",-1)),Ne=[Le];function Te(e,t,r,i,s,o){return c(),l("footer",null,Ne)}var Ue=d(Ie,[["render",Te],["__scopeId","data-v-328c9808"]]);const p=D.create();p.interceptors.request.use(e=>{const t=P.getAccessToken();return t&&(e.headers.Authorization="Bearer "+t),e.headers["Content-Type"]="application/json",e},e=>{Promise.reject(e)});p.interceptors.response.use(async e=>e,async e=>{if(e.response&&e.response.status===403){console.log("token expired");const t=await Fe(e);return console.log("retrying request"),t}return Promise.reject(e)});let V=!1,O=[];async function Fe(e){try{const{response:t}=e,r=P.getRefreshToken();if(!r)return console.log("no refresh token"),Promise.reject(e);const i=new Promise(async s=>{await Me(o=>{t.config.headers.Authorization="Bearer "+o,s(D(t.config))})});if(!V){console.log("fetching access token"),V=!0;const s=await D({method:"post",url:"/api/refresh",data:{token:r}});if(!s.data)return Promise.reject(e);const o=s.data.accessToken;P.setAccessToken(o),V=!1,await Ce(o)}return i}catch(t){return Promise.reject(t)}}async function Ce(e){O.forEach(t=>t(e)),O=[]}async function Me(e){O.push(e)}const A="/api/";class L{static async getUsers(){return new Promise(async(t,r)=>{try{const s=(await p.get(`${A}user`)).data;t(s.map(o=>M(k({},o),{createdAt:new Date(o.createdAt),updatedAt:new Date(o.updatedAt)})))}catch(i){r(i.response)}})}static async getUser(t){try{return await p.get(`${A}user/${t}`)}catch(r){return r.response}}static async getUserByUsername(t){try{return await p.get(`${A}user/username/${t}`)}catch(r){return r.response}}static async registerUser(t){try{return await p.post(`${A}register`,t)}catch(r){return r.response}}static async loginUser(t){try{return await p.post(`${A}login`,t)}catch(r){return r.response}}static async logoutUser(t){try{return await p.post(`${A}logout`,t)}catch(r){return r.response}}}const Re={name:"App",components:{Header:Ae,Footer:Ue},data(){return{result:""}},async created(){try{const{setUser:e,decodeJWT:t,getUser:r}=C(),i=P.getAccessToken(),{user:s}=t(i),o=await L.getUser(s._id);o.status===200&&(e(o.data),this.result=r().value)}catch(e){console.log(e.message)}}};function Ve(e,t,r,i,s,o){var b;const a=u("Header"),m=u("router-view"),w=u("Footer");return c(),l(j,null,[$(a,{user:(b=s.result)==null?void 0:b.user},null,8,["user"]),n("main",null,[$(m)]),$(w)],64)}var He=d(Re,[["render",Ve]]);const H="/api/posts/";class S{static getPosts(){return new Promise(async(t,r)=>{try{const s=(await p.get(H)).data;t(s.map(o=>M(k({},o),{createdAt:new Date(o.createdAt)})))}catch(i){r(i)}})}static insertPost(t){return p.post(H,{text:t})}static deletePost(t){return p.delete(`${H}${t}`)}}const De={name:"PostComponent",data(){return{posts:[],error:"",text:""}},async created(){try{this.posts=await S.getPosts()}catch(e){this.error=e.message}},methods:{async createPost(){await S.insertPost(this.text),this.posts=await S.getPosts(),this.text=""},async deletePost(e){await S.deletePost(e),this.posts=await S.getPosts()}}},B=e=>(N("data-v-37eb1acf"),e=e(),T(),e),Oe={class:"container"},Ee=B(()=>n("h1",null,"Latest Posts",-1)),je={class:"create-post"},Be=B(()=>n("label",{for:"create-post"},"Say something...",-1)),qe=B(()=>n("hr",null,null,-1)),ze={key:0,class:"error"},Je={class:"posts-container"},We=["onDblclick"],Ke={class:"created-at"},Ye={class:"text"};function Ge(e,t,r,i,s,o){return c(),l("div",Oe,[Ee,n("div",je,[Be,g(n("input",{type:"text",id:"create-post","onUpdate:modelValue":t[0]||(t[0]=a=>s.text=a),placeholder:"Create a post"},null,512),[[h,s.text]]),n("button",{onClick:t[1]||(t[1]=(...a)=>o.createPost&&o.createPost(...a))},"Post!")]),qe,s.error?(c(),l("p",ze,I(s.error),1)):_("",!0),n("div",Je,[(c(!0),l(j,null,ne(s.posts,a=>(c(),l("div",{class:"post",key:a._id,onDblclick:m=>o.deletePost(a._id)},[n("div",Ke,I(`${a.createdAt.getDate()}/${a.createdAt.getMonth()}/${a.createdAt.getFullYear()}`),1),n("p",Ye,I(a.text),1)],40,We))),128))])])}var Qe=d(De,[["render",Ge],["__scopeId","data-v-37eb1acf"]]);const Xe={name:"Login",data(){return{email:"",password:"",errorMsg:""}},methods:{async login(){const{setUser:e,decodeJWT:t}=C();if(this.email.trim()!==""&&this.password.trim()!==""){const r={email:this.email,password:this.password},i=await L.loginUser(r);if(i.status===200){const{accessToken:s,refreshToken:o}=i.data,a=t(s);e(a),P.setAccessToken(s),P.setRefreshToken(o),this.email="",this.password=""}else this.errorMsg="Invalid login"}else this.errorMsg="Email and Password and required fields"},hasAccount(){this.$emit("toggle-form",!1)}}},U=e=>(N("data-v-5e209e2c"),e=e(),T(),e),Ze=U(()=>n("h1",null,"Login",-1)),et={key:0,class:"error"},tt={class:"input"},st=U(()=>n("label",{for:"email"},"email",-1)),ot={class:"input"},rt=U(()=>n("label",{for:"password"},"password",-1)),nt=U(()=>n("input",{type:"submit",value:"login"},null,-1)),at={class:"toggle"},it=U(()=>n("p",null,"Don't have an account?",-1));function ct(e,t,r,i,s,o){return c(),l("form",{onSubmit:t[3]||(t[3]=J((...a)=>o.login&&o.login(...a),["prevent"]))},[Ze,s.errorMsg.length>0?(c(),l("span",et,I(s.errorMsg),1)):_("",!0),n("div",tt,[st,g(n("input",{id:"email","onUpdate:modelValue":t[0]||(t[0]=a=>s.email=a),type:"text"},null,512),[[h,s.email]])]),n("div",ot,[rt,g(n("input",{id:"password","onUpdate:modelValue":t[1]||(t[1]=a=>s.password=a),type:"text"},null,512),[[h,s.password]])]),nt,n("div",at,[it,n("button",{onClick:t[2]||(t[2]=(...a)=>o.hasAccount&&o.hasAccount(...a))},"Register")])],32)}var lt=d(Xe,[["render",ct],["__scopeId","data-v-5e209e2c"]]);const dt={name:"Register",data(){return{email:"",password:"",repeatPassword:"",username:"",firstName:"",lastName:"",extraToggle:!1,errorMsg:""}},methods:{async onSubmit(e){this.errorMsg="",this.email.trim()!==""&&this.password.trim()!==""&&this.repeatPassword.trim()!==""?this.password.trim()===this.repeatPassword.trim()?await this.createUser(e):this.errorMsg="Passwords don't match":this.errorMsg="Email and Password are required!"},async createUser(e){const{email:t,password:r,username:i,firstName:s,lastName:o}=Object.fromEntries(new FormData(e.target)),a={username:i,password:r,firstName:s,lastName:o,email:t},m=await L.registerUser(a);m.status===201?(this.email="",this.password="",this.repeatPassword="",this.username="",this.firstName="",this.lastName="",this.errorMsg=""):m.status===422?this.errorMsg="Email already in use":this.errorMsg="Something went wrong, try again later"},hasAccount(){this.$emit("toggle-form",!0)}}},f=e=>(N("data-v-9807cb52"),e=e(),T(),e),ut=f(()=>n("h1",null,"Register",-1)),_t={key:0,class:"error"},mt={class:"input"},pt=f(()=>n("label",{for:"email"},"email",-1)),gt=f(()=>n("label",{class:"extra-details",for:"extraToggle"},"Extra details...",-1)),vt={class:"extra"},ft={class:"input"},ht=f(()=>n("label",{for:"username"},"username",-1)),yt={class:"input"},wt=f(()=>n("label",{for:"firstName"},"first",-1)),$t={class:"input"},bt=f(()=>n("label",{for:"lastName"},"last",-1)),Pt={class:"input"},kt=f(()=>n("label",{for:"password"},"password",-1)),xt={class:"input"},At=f(()=>n("label",{for:"repeatPassword"},"repeat password",-1)),It=f(()=>n("input",{type:"submit",value:"register"},null,-1)),St={class:"toggle"},Lt=f(()=>n("p",null,"Have an account?",-1));function Nt(e,t,r,i,s,o){return c(),l("form",{onSubmit:t[8]||(t[8]=J((...a)=>o.onSubmit&&o.onSubmit(...a),["prevent"]))},[ut,s.errorMsg.length>0?(c(),l("span",_t,I(s.errorMsg),1)):_("",!0),n("div",mt,[pt,g(n("input",{id:"email",name:"email","onUpdate:modelValue":t[0]||(t[0]=a=>s.email=a),type:"text"},null,512),[[h,s.email]])]),g(n("input",{id:"extraToggle",name:"extraToggle","onUpdate:modelValue":t[1]||(t[1]=a=>s.extraToggle=a),type:"checkbox"},null,512),[[ae,s.extraToggle]]),gt,n("div",vt,[n("div",ft,[ht,g(n("input",{id:"username",name:"username","onUpdate:modelValue":t[2]||(t[2]=a=>s.username=a),type:"text"},null,512),[[h,s.username]])]),n("div",yt,[wt,g(n("input",{id:"firstName",name:"firstName","onUpdate:modelValue":t[3]||(t[3]=a=>s.firstName=a),type:"text"},null,512),[[h,s.firstName]])]),n("div",$t,[bt,g(n("input",{id:"lastName",name:"lastName","onUpdate:modelValue":t[4]||(t[4]=a=>s.lastName=a),type:"text"},null,512),[[h,s.lastName]])])]),n("div",Pt,[kt,g(n("input",{id:"password",name:"password","onUpdate:modelValue":t[5]||(t[5]=a=>s.password=a),type:"text"},null,512),[[h,s.password]])]),n("div",xt,[At,g(n("input",{id:"repeatPassword",name:"repeatPassword","onUpdate:modelValue":t[6]||(t[6]=a=>s.repeatPassword=a),type:"text"},null,512),[[h,s.repeatPassword]])]),It,n("div",St,[Lt,n("button",{onClick:t[7]||(t[7]=(...a)=>o.hasAccount&&o.hasAccount(...a))},"Login")])],32)}var Tt=d(dt,[["render",Nt],["__scopeId","data-v-9807cb52"]]);const Ut={name:"Home",components:{PostComponent:Qe,Login:lt,Register:Tt},data(){return{isLoggedIn:!1,hasAccount:!1,users:[]}},async created(){const{getIsLoggedIn:e}=C();this.isLoggedIn=e()},methods:{toggleForm(e){this.hasAccount=e}}};function Ft(e,t,r,i,s,o){const a=u("PostComponent"),m=u("Login"),w=u("Register");return c(),l(j,null,[s.isLoggedIn===!0?(c(),y(a,{key:0})):_("",!0),s.hasAccount===!0&&s.isLoggedIn===!1?(c(),y(m,{key:1,onToggleForm:o.toggleForm},null,8,["onToggleForm"])):_("",!0),s.hasAccount===!1&&s.isLoggedIn===!1?(c(),y(w,{key:2,onToggleForm:o.toggleForm},null,8,["onToggleForm"])):_("",!0)],64)}var Ct=d(Ut,[["render",Ft]]),Mt="/assets/mongodb.e2bfe7d8.png",Rt="/assets/mongoose.e352560f.png",Vt="/assets/expressjs.40799037.svg",Ht="/assets/vue.77ba2af1.svg",Dt="/assets/vite.17e50649.svg",Ot="/assets/node.a2054365.svg";const Et={name:"About"},jt={class:"container"},Bt=ie('<h1 data-v-0e84b287>About the project</h1><dl data-v-0e84b287><dt data-v-0e84b287><span class="mongo" data-v-0e84b287>M</span><span class="express" data-v-0e84b287>E</span><span class="vue" data-v-0e84b287>V</span><span class="node" data-v-0e84b287>N</span> Stack</dt><dd class="mongo" data-v-0e84b287><img alt="mongo" src="'+Mt+'" data-v-0e84b287>Mongo DB<span class="mongoose" data-v-0e84b287>+ Mongoose<img alt="mongoose" src="'+Rt+'" data-v-0e84b287></span></dd><dd class="express" data-v-0e84b287><img alt="express" src="'+Vt+'" data-v-0e84b287>Express.js</dd><dd class="vue" data-v-0e84b287><img alt="vue" src="'+Ht+'" data-v-0e84b287>Vue + Vite<img alt="vite" src="'+Dt+'" data-v-0e84b287></dd><dd class="node" data-v-0e84b287><img alt="node" src="'+Ot+'" data-v-0e84b287>Node</dd></dl>',2),qt=[Bt];function zt(e,t,r,i,s,o){return c(),l("div",jt,qt)}var Jt=d(Et,[["render",zt],["__scopeId","data-v-0e84b287"]]);const Wt={name:"ProfileHeader",props:{username:String,img:String,imgAlt:String,backgroundImage:String},computed:{cssProps(){return{"--bgImg":"url("+this.backgroundImage+")"}}}},Kt={class:"hero"},Yt={class:"user"},Gt=["src","alt"];function Qt(e,t,r,i,s,o){return c(),l("div",{style:ce(o.cssProps)},[n("div",Kt,[n("div",Yt,[n("img",{src:r.img,alt:r.imgAlt},null,8,Gt),n("h1",null,I(r.username),1)])])],4)}var Xt=d(Wt,[["render",Qt],["__scopeId","data-v-0bd26600"]]);const Zt={name:"ProfileNav",data(){return{active:"overview"}},created(){this.$emit("active",this.active)},methods:{selected(e){this.active=e,this.$emit("active",e)}}},es={class:"profile-nav"};function ts(e,t,r,i,s,o){return c(),l("div",es,[n("button",{onClick:t[0]||(t[0]=a=>o.selected("overview")),class:x(s.active==="overview"?"active":"")},"Overview",2),n("button",{onClick:t[1]||(t[1]=a=>o.selected("animelist")),class:x(s.active==="animelist"?"active":"")},"AnimeList",2),n("button",{onClick:t[2]||(t[2]=a=>o.selected("favorites")),class:x(s.active==="favorites"?"active":"")},"Favorites",2),n("button",{onClick:t[3]||(t[3]=a=>o.selected("stats")),class:x(s.active==="stats"?"active":"")},"Stats",2),n("button",{onClick:t[4]||(t[4]=a=>o.selected("socials")),class:x(s.active==="socials"?"active":"")},"Socials",2),n("button",{onClick:t[5]||(t[5]=a=>o.selected("reviews")),class:x(s.active==="reviews"?"active":"")},"Reviews",2)])}var ss=d(Zt,[["render",ts],["__scopeId","data-v-4f775fac"]]);const os={name:"ProfileOverview"};function rs(e,t,r,i,s,o){return c(),l("div",null," Overview ")}var ns=d(os,[["render",rs]]);const as={name:"ProfileAnimeList"};function is(e,t,r,i,s,o){return c(),l("div",null," Anime List ")}var cs=d(as,[["render",is]]);const ls={name:"ProfileFavorites"};function ds(e,t,r,i,s,o){return c(),l("div",null," Favorites ")}var us=d(ls,[["render",ds]]);const _s={name:"ProfileStats"};function ms(e,t,r,i,s,o){return c(),l("div",null," Stats ")}var ps=d(_s,[["render",ms]]);const gs={name:"ProfileSocials"};function vs(e,t,r,i,s,o){return c(),l("div",null," Socials ")}var fs=d(gs,[["render",vs]]);const hs={name:"ProfileReviews"};function ys(e,t,r,i,s,o){return c(),l("div",null," Reviews ")}var ws=d(hs,[["render",ys]]);const $s={name:"Profile",components:{ProfileReviews:ws,ProfileSocials:fs,ProfileStats:ps,ProfileFavorites:us,ProfileAnimeList:cs,ProfileOverview:ns,ProfileHeader:Xt,ProfileNav:ss},props:{username:String},data(){return{user:{},email:"",name:"",first:"",last:"",img:"",imgAlt:"",bgImg:"",section:""}},async created(){if(this.$watch(async()=>this.$route.params,async e=>{const{username:t}=await e;if(t){const{data:r}=await L.getUserByUsername(t);await this.updateProfile(r)}}),this.username){const{data:e}=await L.getUserByUsername(this.username);await this.updateProfile(e)}},methods:{activeSection(e){this.section=e},async updateProfile(e){var t,r,i,s;this.email=e==null?void 0:e.email,this.name=(e==null?void 0:e.userName)===""?e==null?void 0:e.email:(t=e==null?void 0:e.userName)!=null?t:"Not Found",this.first=e==null?void 0:e.firstName,this.last=e==null?void 0:e.lastName,this.img=(r=e==null?void 0:e.img)!=null?r:`https://picsum.photos/seed/${this.name}/260/280`,this.imgAlt=(i=e==null?void 0:e.imgAlt)!=null?i:"profile image",this.bgImg=(s=e==null?void 0:e.bgImg)!=null?s:"https://picsum.photos/2000/400"}}},bs={class:"content"};function Ps(e,t,r,i,s,o){const a=u("ProfileHeader"),m=u("ProfileNav"),w=u("ProfileOverview"),b=u("ProfileAnimeList"),K=u("ProfileFavorites"),Y=u("ProfileStats"),G=u("ProfileSocials"),Q=u("ProfileReviews");return c(),l("section",null,[n("header",null,[$(a,{username:s.name,img:s.img,"img-alt":s.imgAlt,"background-image":s.bgImg},null,8,["username","img","img-alt","background-image"]),$(m,{onActive:o.activeSection},null,8,["onActive"]),n("div",bs,[s.section==="overview"?(c(),y(w,{key:0})):_("",!0),s.section==="animelist"?(c(),y(b,{key:1})):_("",!0),s.section==="favorites"?(c(),y(K,{key:2})):_("",!0),s.section==="stats"?(c(),y(Y,{key:3})):_("",!0),s.section==="socials"?(c(),y(G,{key:4})):_("",!0),s.section==="reviews"?(c(),y(Q,{key:5})):_("",!0)])])])}var ks=d($s,[["render",Ps],["__scopeId","data-v-3311a43c"]]);const xs=[{path:"/",name:"Home",component:Ct},{path:"/about",name:"About",component:Jt},{path:"/profile/:username",name:"Profile",component:ks,props:!0}],As=le({history:de("/"),routes:xs,linkExactActiveClass:"active"});ue(He).use(As).mount("#app");
